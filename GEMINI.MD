# GEMINI.md: プロジェクト Trend-Nexus 開発・運用ガイドライン

## 1. 基本原則 (Fundamental Principles)
* **日本語優先**: チャット、コメント、ドキュメント、ログ出力はすべて日本語で行うこと。
* **思考の透明化**: 動作は止めずに進めてよいが、各アクションは必ず「目的」と「手順」を日本語でユーザーに解説せよ。
* **自律的解決**: Windows環境の制約を理解し、ログ解析を基に自律的にデバッグせよ。

## 2. Windowsターミナル実行「鉄の掟」（重要）
現在の環境ではセキュリティ上の制限があるため、以下の実行方式を厳守せよ。

### ① コマンド・ラッピング
外部コマンド（Python, Git, npm等）は、必ず `cmd /c` を介して実行せよ。
- ✅ 推奨: `run_command("cmd /c python -u script.py")`
- ❌ 禁止: 直接的な実行（ハングアップの恐れあり）

### ② バッチファイル・リダイレクトの禁止
バッチファイル（.bat）の実行および、シェルレベルのリダイレクト（`>` や `>>`）は、プロセスをフリーズさせるため**使用厳禁**とする。
- ❌ 禁止: `cmd /c python script.py > log.txt`
- ✅ 代替: ログが必要な場合は、Python内部で `open()` を使用して書き込むか、標準出力 (print) を `read_terminal` 等で読み取れ。

### ③ Python実行時のフラグ
出力をリアルタイムで取得するため、必ず `-u` フラグを付与せよ。
- ✅ 必須: `cmd /c python -u <filename>.py`

## 3. 標準ドキュメント管理体系 (Standard Documentation Management)

本プロジェクトの全ドキュメントは `./_foundation_/` フォルダに集約し、以下の「不変のルール」に従って管理せよ。

### 3.1. フォルダ構成と役割

エージェントは `./doc/` フォルダを無視し、以下の構成を「プロジェクトの憲法」として参照・更新せよ。

1. **`00_concept.md`**: プロジェクト理念・目的（随時更新）
2. **`01_tech_spec.md`**: 技術仕様・データ構造・APIマッピング（随時更新）
3. **`02_roadmap.md`**: 全体工程・マイルストーン（随時更新）
4. **`03_tasks.md`**: 現行タスク・ToDoリスト（頻繁に更新）
5. **`troubleshoot_logs/`**: **【最重要】** トラブル解決履歴（**新規ファイル追加のみ許可**）

---

### 3.2. 【絶対厳守】トラブルシューティングの「分冊ジャーナル」方式

情報の断絶と消失を防ぐため、**「一つのファイル（history.md等）に追記していく方式」を全面的に禁止する。** AIがファイルを書き換える際の「情報の省略・整理」を物理的に封じ込めるため、以下の手順を徹底せよ。

#### ① 履歴は「1事象1ファイル」の新規作成

トラブルが発生し、対応を行った際は、既存のファイルを編集せず、必ず**新しいファイル**を作成して記録せよ。

* **保存先**: `./_foundation_/troubleshoot_logs/`
* **命名規則**: `YYYYMMDD_HHMM_事象名.md`
* 例：`20260121_2200_wsarecv_hang_fix.md`



#### ② 既存ログの「読み取り専用」原則

過去のログファイルは「読み取り専用」の歴史記録である。

* **削除の禁止**: 解決済みの事象であっても、過去のログを削除、あるいは一つのファイルに統合してはならない。
* **参照の義務**: 新しいアクションを起こす前には、必ず `troubleshoot_logs/` フォルダ内の全ファイルを読み込み、過去の地雷（ハングアップ条件等）を確認せよ。

#### ③ 過去事象への「上書き」ではなく「新章」

過去のトラブルに新たな知見が得られた場合でも、元のファイルを書き換えてはならない。

* `参照元：[旧ファイル名]` と冒頭に記述した上で、新しいログファイルを作成して情報をアップデートせよ。

---

### 3.3. エージェントの動作プロセス

1. **思考開始時**: `./_foundation_/` 以下の全ドキュメント、特に `troubleshoot_logs/` 内の全ファイルをスキャンし、現在のコンテキストと過去の禁止事項を同期せよ。
2. **ドキュメント更新時**: `01`〜`03` の基本書類を更新する際は、古い重要情報を「整理」という名目で削除していないか、自己検閲せよ。
3. **トラブル解決時**: 解決策を `run_command` で検証し、成功を確認したら、即座に「新規ログファイル」を作成して知見を固定せよ。

## 4. システム負荷・リソース管理 (Resource & System Management)

自律的な開発において、システム全体を不安定にさせる挙動（フリーズ、メモリリーク等）を未然に防ぐため、以下の項目を厳守せよ。

### ① リソース消費の最適化
- コード実行前に、無限ループやメモリリーク、過度なI/Oが発生する可能性がないか静的解析を徹底せよ。
- 他の高負荷アプリ（ComfyUI等）との並行動作を前提とし、実行プロトコルは可能な限り軽量なものを選択せよ。

### ② 異常なプロセスの監視
- Node.jsの監視プロセス（ホットリロード等）や非同期処理のスタックが、不適切な終了条件によってループしたり蓄積（ゾンビ化）したりしていないか常に注視せよ。
- リソースのスパイク（急上昇）や異常な挙動を検知した場合は、直ちに処理を中断し、実行ログ等のアーティファクトを分析してユーザーに報告せよ。

### ③ 並列実行の抑制
- `npm install` や大規模なファイル操作など、システム負荷の高いタスクを複数のエージェントで同時に走らせないよう、実行タイミングを自律的に制御せよ。