---
STATUS: CANONICAL (正本)
IMMUTABLE_SECTIONS: [全セクション]
LAST_VERIFIED: 2026-02-04
SOURCE: docs/reference/Game_Domain_Spec.md
---

# ゲームメカニクスの不変ルール

> [!CAUTION]
> **このドキュメントは実装の根拠となる正本です**
> 
> 全てのセクションは**絶対に要約・削除しないこと**。
> AI更新時は、必ず元の情報を保持してください。

**Purpose**: ゲームシステムの不変ルールを定義  
**Version**: 3.3.0  
**Last Updated**: 2026-02-04

---

## 1. 出現判定とライフサイクルの基本原則

本システムの計算および状態管理における根本的なルール。

### 1.1 出現の判定（重み 0 の定義）

特定の条件（特定の天気、あるいは発見・直感等）を満たしていない魚種は、その時点の重みが $0$ となり、抽選テーブルから物理的に除外される。

**隠し魚（Hidden）の特殊ルール**:
- 未発見状態においては重み $w$ を一貫して $0$ とする
- 基本ヒット率算出の分母（全出現候補の重みの総和）には含めない

### 1.2 効果の有効期間と揮発性（リセットタイミング）

ルアーアクションやスキルによって発生した特殊状態（発見、型確定、重み補正、撒き餌等）は、原則として**1回のアクションサイクル（キャスト）内でのみ有効**である。

詳細なリセット条件は「2. スキル・状態の持続・リセット詳細」を参照。

---

## 2. スキル・状態の持続・リセット詳細

各スキルおよび特殊状態の終了条件。**本表を状態管理ロジックの正本とする**。

| 状態・スキル | リセット・終了のタイミング | 特記事項 |
| :--- | :--- | :--- |
| **発見・型確定** | 1サイクル終了時 (釣り上げ動作/竿上げ動作終了後) | 前回の硬直終了時に消滅する |
| **重み補正 ($M_{Nx}$)** | 1サイクル終了時 (釣り上げ動作/竿上げ動作終了後) | サイクルを跨いで引き継がれない |
| **撒き餌** | 1サイクル終了時 (釣り上げ動作/竿上げ動作終了後) | 竿上げやアタリ無視でも効果は消失する |
| **トレードリリース** | **魚を釣り上げた(Catch)瞬間** | **竿上げ(Rod Lift)では終了せず、次サイクルに継続する** |

### 時間制限の定義

撒き餌、ルアー、トレードリリースには、**バフとしての時間制限は存在しない**。

一度付与された効果は、上記の終了条件を満たすまで永続する。

---

## 3. 1サイクルのタイムラインとスキル介入仕様

### 3.1 キャストフローの5段階

#### 1. キャスト前準備 (Pre-Cast)
- 動作硬直があるスキルを使用する場合に追加
- 例：「撒き餌」を使用する場合、`D_CHUM` (1.0s) を消費

#### 2. キャスティング (Cast Execution)
- `D_CAST` (1.0s) を消費
- 待機時間のカウント開始

#### 3. アタリ待機とスキル介入 (Waiting & Skills)
- ルアーアクション実行ごとに `D_LURE` (2.5s) を消費
- ルアー種類と魚種の「型」が照合され、`WEIGHT` に重み補正倍率 `M_Nx` が適用される
- 計算上のアタリ発生下限（空白時間）は `(n * D_LURE) + D_BLK` となる

#### 4. アタリ発生 (Bite Event)
- 実効待機時間 $T_{Final}$ 到達時に震動が発生

#### 5. 終了フェーズ (Finish Phase) ※条件分岐
終了後、各状態のリセット条件は「2. スキル・状態の持続・リセット詳細」の表に従う。

- **パターンA：釣り上げ (Catch)**
  - `D_HOOK` を消費
- **パターンB：竿上げ (Rod Lift)**
  - `D_REST` を消費

---

## 4. アクション・スキル効果定義

| アクション名 | 実行タイミング | 影響を受ける変数・論理 | 詳細仕様 |
| :--- | :--- | :--- | :--- |
| **キャスト** | サイクル開始 | `D_CAST` | 1サイクルの起点 |
| **撒き餌** | キャスト前 | `C_CHUM` | ヒット時間を 0.6倍にする |
| **ルアー** | 待機中 | `M_Nx` / `DISC` / `GUAR` | 重み補正・発見・確定判定 |
| **トレードリリース** | キャスト前 | `WEIGHT = 0` | 特定魚種を除外 |
| **フッキング** | アタリ発生時 | `D_HOOK` | 魚を釣り上げ、サイクルを終了する |
| **竿上げ (Rod Lift)** | アタリ発生時 | `D_REST` | サイクルを中断し、終了する |

---

## 5. 魚種の型（Jaws）と状態（State）の厳密定義

| 用語 | 物理的な分類 | 意味・対応スキル | Code表記 |
| :--- | :--- | :--- | :--- |
| **小型** | 型 (Type) | 小型魚。モデストルアー、プレシジョンフッキングの対象 | `small jaws` |
| **大型** | 型 (Type) | 大型魚。アンビシャスルアー、ストロングフッキングの対象 | `large jaws` |
| **ラージサイズ** | 状態 (State) | 釣り上げた後のサイズ状態。ヒット率計算には関与しない | `large-sized` |

### データの正規化

- CSVおよびUI上の表記は「日本語」とするが、システム内部では対応する「Code表記」に変換して処理する
- 演出記号（! / !! / !!!）は半角に統一する
- プログラム内変換例：`小型` → `small jaws`, `大型` → `large jaws`

---

## 6. ルアー効果の重要な特性

### 6.1 ルアー適合性ゲート

隠し魚の「発見」判定は、使用中のルアーの型（アンビシャス=大型 / モデスト=小型）が隠し魚の「型」と一致している場合にのみ実行される。

**不一致の場合**: 発見率は一貫して 0% となる

### 6.2 型確定の効果

型確定成功時、不適合な型の魚種は重み補正 $M = 0$ となり、抽選から除外される。

---

## 7. トレードリリース (Surface Slap) の特殊挙動

### 7.1 使用条件

`マスタ - 魚種.csv` の「トレード可否」列が 0 の魚種には、トレードリリースを使用することはできない（UI制御）。

### 7.2 効果の持続

**重要**: トレードリリースは他のスキルと異なり、**竿上げ (Rod Lift) では終了しない**。

- **終了条件**: 魚を釣り上げた (Catch) 瞬間
- **継続条件**: 竿上げした場合、次サイクルに効果が継続する

### 7.3 重みへの影響

使用時、対象魚の基礎重みを $0$ とする。

---

## 8. 震動演出と動作時間の分離

### 8.1 震動演出（!/!!/!!!）

演出のみを決定し、釣り上げ時間には直接関与しない。

### 8.2 釣り上げ動作時間 ($D_{Hook}$)

魚種ごとに「魚種マスタ.csv」の値を直接参照する。

演出記号とは独立した値。

---

## 9. 出現条件と動的パラメータ

以下の要素の組み合わせにより、そのキャストにおける各魚種の「基礎重み ($w_i$)」、「基礎待機時間(Min) ($T_{BiteMin, i}$)」、「基礎待機時間(Max) ($T_{BiteMax, i}$)」が決定される。

- **餌 (Bait)**
- **時間・天気条件 (Time / Weather)**
- **発見の有無 (Discovery status)**
- **直感の有無 (Intuition status)** ※注：本ツールでは直感の計算は行わないが、論理定義として保持する

---

## 10. CSVデータ連携定義

### 10.1 魚種マスタ (`マスタ - 魚種.csv`)

**列定義**: 
- `魚種`, `型`, `演出`, `釣り上げ動作時間`, `隠し判定` (0:通常 / 1:隠し), `トレード可否` (0:不可 / 1:可)

### 10.2 釣り場定義 (`マスタ - 釣り場定義.csv`)

**列定義**: 
- `データ種別`, `釣り場`, `データ`

**データ種別リスト**: 
- `{天気 / 時間, 餌, 魚種}`

### 10.3 基礎重み・基礎待機時間マスタ (`マスタ - 基礎重み・基礎待機時間.csv`)

**列定義**: 
- `釣り場`, `天気 / 時間`, `餌`, `魚種`, `基礎重み`, `基礎待機時間min`, `基礎待機時間max`

### 10.4 発見・型確定・隠しヒット率マスタ (`マスタ - 発見・型確定・隠しヒット率.csv`)

**列定義**:
- `釣り場`, `天気 / 時間`, `餌`, `対象隠し魚`, `トレード対象`, `ルアー種類`
- `発見率1`, `発見率2`, `発見率3`
- `未発見型確定率1`, `未発見型確定率2`, `未発見型確定率3`
- `発見1型確定率2`, `発見1型確定率3`, `発見2型確定率3`
- `発見1型確1なし隠しヒット率1`
- `発見1型確2あり隠しヒット率2`, `発見1型確2なし隠しヒット率2`
- `発見1型確3あり隠しヒット率3`, `発見1型確3なし隠しヒット率3`
- `発見2型確2なし隠しヒット率2`
- `発見2型確3あり隠しヒット率3`, `発見2型確3なし隠しヒット率3`
- `発見3型確3なし隠しヒット率3`

---

## 11. 実装上の注意事項

### 11.1 状態管理

各サイクル終了時に、必ず「2. スキル・状態の持続・リセット詳細」の表に従って状態をリセットすること。

### 11.2 重み計算

重み $w = 0$ の魚種は、ヒット率計算の分母から除外すること。

### 11.3 時間計算

撒き餌使用時は、$Min, Max$ に $C_{Chum}$ (0.6) を乗じた値を使用すること。

---

## CHANGELOG

- **2026-02-04**: 初版作成（AI引き継ぎ問題の解決のため、Game_Domain_Spec.md から抽出）
