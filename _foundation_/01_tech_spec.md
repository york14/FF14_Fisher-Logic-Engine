# 技術仕様・データ構造 (Technical Specification)

## 1. ゲームドメイン定義 (Game Domain Spec)

### 1.1 釣り場の構成と出現の論理階層
FF14における釣りの抽選論理は、以下の3つの階層構造によって決定される。

#### 1.1.1 魚種の固有属性（静的データ）
- **型 (Jaws)**: `small jaws` (小型) / `large jaws` (大型)
- **釣り上げ動作時間 ($D_{Hook}$)**: 物理的な拘束時間 (5s/9s/13s等)
- **隠し魚 (Hidden)**: 通常テーブルには含まれず、ルアーアクションによる「発見」状態でのみ出現。

#### 1.1.2 出現条件と動的パラメータ
- **餌 (Bait)**
- **時間・天気 (Time/Weather)**
- **発見 (Discovery)**
- **直感 (Intuition)**

### 1.2 重み抽選の基本概念
ヒット率 $P_i$ は、現在有効な全出現候補の重みの総和に対する、自身の重みの割合として定義される。
$$P_i = \frac{w_i}{\sum w_k}$$

### 1.3 アクション・スキル効果定義
- **キャスト**: $D_{Cast}$ (1.0s)
- **撒き餌 (Chum)**: $D_{Chum}$ (1.0s), 時間短縮 $C_{Chum}$ (0.6倍)
- **ルアー (Lure)**: $D_{Lure}$ (2.5s), 空白時間 $D_{Blk}$ (2.5s), 重み補正 $M_{Nx}$ (1.5/2.0/6.0倍)
- **竿上げ (Rod Lift)**: $D_{Rest}$ (2.0s)

## 2. システム要件 (System Requirements)

### 2.1 機能構成
- **手動設定モード**: 単一シナリオにおける詳細な確率と時間を計算するモード。
- **戦略評価モード**: 複数のシナリオ（例：「L2固定」など）を含む戦略プリセットの総合評価を行うモード。

### 2.2 ロジック仕様 (Logic Specification)
- **シナリオID**: `n{回数}_d{発見ステップ}_g{型確定ステップ}`
- **時間計算式**:
  $$T_{Cycle} = T_{Pre} + D_{Cast} + \max(T_{Bite}, T_{Lure}) + T_{End}$$
  - $T_{End}$ は釣り上げ($D_{Hook}$)または竿上げ($D_{Rest}$)のいずれか。
  - **未発見即竿上げ**の場合: $T_{Wait}$ を待たず、ルアー動作後に即座に竿上げを行う。

### 2.3 データ構造 (JSON Schema)
```json
{
  "version": "2.8.0",
  "spots": { ... },
  "weights": { "key": [...] },
  "probabilities": [...]
}
```
詳細は `logic_master.json` および `System_Spec.md` を参照のこと。
