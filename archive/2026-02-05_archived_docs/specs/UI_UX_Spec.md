# UI/UX 仕様書

本書は、ユーザーインターフェース構造、インタラクションフロー、および表示ロジックをまとめたものである。
実装: `src/main.js`, `src/ui/controls.js`, `src/ui/render.js`, `index.html`

## 1. レイアウト構造

アプリケーションは、境界調整可能な (Resizable) 3ペイン構成を採用している。

*   **左パネル (設定/Control)**:
    *   基本設定 (拡張、エリア、釣り場)。
    *   条件設定 (天気、餌、ターゲット)。
    *   モード切替タブ (手動設定 / 戦略評価)。
    *   モード固有設定 (ルアー詳細、戦略プリセット)。
*   **中央パネル (結果/Result)**:
    *   メイン出力エリア。
    *   手動モード: 大きな「期待時間」表示、GP収支、魚種別テーブル。
    *   戦略モード: 比較カード (Set A vs Set B)。
*   **右パネル (詳細/Debug)**:
    *   開閉可能なサイドパネル。
    *   内部計算トレース、重みテーブル、デバッグ定数を表示。

## 2. インタラクションフロー

1.  **初期化 (Initialization)**:
    *   ロード時 (`main.js`)、`masterDB` を読み込む。
    *   セレクターを初期化する。
    *   `initResizers()` でパネルのドラッグ操作をバインドする。

2.  **依存関係チェーン (Dependency Chain)**:
    *   **拡張 (Expansion)** 選択 -> **エリア (Area)** リスト更新。
    *   **エリア** 選択 -> **釣り場 (Spot)** リスト更新。
    *   **釣り場** 選択 -> 以下のリストを一括更新:
        *   **天気 (Weather)**
        *   **餌 (Bait)**
        *   **ターゲット魚 (Target Fish)**
        *   **トレードリリース (Surface Slap)** 候補
        *   *同時にシミュレーションを即時実行*

3.  **リアルタイム計算**:
    *   入力値の変更トリガーで常に `updateSimulation()` を呼び出す。
    *   無効な状態（例：釣り場データなし）は即座にエラーフィードバックを行う。

## 3. エラーハンドリングとフィードバック

### 3.1 データ検証
*   **釣り場データ欠落**:
    *   トリガー: `spotData.fish_list` が空の場合。
    *   アクション: 結果パネルに赤い破線枠で「⚠️ データ未定義」を表示。
    *   コード: `controls.js` の `updateSpotDependents`。

### 3.2 ロジック検証
*   **不正なルアー設定**:
    *   トリガー: 手動モードで「発見」を2回以上選択した場合。
    *   アクション: コントロールパネル内に赤字で「※発見は１度まで」を表示。
    *   コード: `main.js` の `updateLureUI`。

### 3.3 計算エラー
*   **確率計算不能**:
    *   トリガー: 必要な確率データがDBに存在しない場合。
    *   アクション: 結果パネルに "Error: [理由]" を表示。

## 4. モード仕様

### 4.1 手動設定モード (Manual Mode)
*   単一の特定シナリオ（例：「ルアー2回、Step1で発見」）に焦点を当てる。
*   以下を詳細に内訳表示する:
    *   魚種ごとのヒット率。
    *   待機時間 (Min/Max/Avg)。
    *   サイクル時間の構成要素。

### 4.2 戦略評価モード (Strategy Evaluation)
*   2つのポリシーセット (A vs B) の比較に焦点を当てる。
*   「戦略プリセット」（例：「未発見なら即竿上げ」など）に基づき、複数のシナリオを加重平均する。
*   以下の機能を表示:
    *   発生確率トップ3シナリオ。
    *   加重平均メトリクス（ヒット率、サイクル）。
    *   GP持続可能性の比較。
